C51 COMPILER V9.60.0.0   MAIN                                                              11/07/2019 15:42:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Users\M\AppData\Local\Keil\Keil_v4\C51\BIN\C51.EXE ..\lib\user\main.c LARGE OPTIMIZE(8,SPEED) BR
                    -OWSE INCDIR(..\lib\n76e003\Include;..\lib\user\inc) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TA
                    -BS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "global.h"
   2          #include "func.h"
   3          
   4          void feedDogInIsr(unsigned int ms);
   5          
   6          void initTimer3(void)
   7          {
   8   1        T3CON = 0x07; //128åˆ†é¢‘
   9   1        
  10   1        RH3 = (65536-125)/256;  //1ms
  11   1        RL3 = (65536-125)%256;   
  12   1       
  13   1        set_ET3;  //enable Timer3 interrupt
  14   1        set_EA; //enable interrupts
  15   1        set_TR3;  //Timer3 run
  16   1      }
  17          
  18          void Timer3_ISR (void) interrupt 16
  19          {
  20   1        clr_TF3;
  21   1        run();
  22   1      
  23   1        feedDogInIsr(2000); //å–‚ç‹—
  24   1      }
  25          
  26          void usartInit(void)
  27          {
  28   1        set_EA; //ä½¿èƒ½æ€»ä¸­æ–­
  29   1        set_ES; //ä½¿èƒ½ä¸²å£0ä¸­æ–­
  30   1      
  31   1        P06_Quasi_Mode;   //Setting UART pin as Quasi mode for transmit
  32   1        P07_Quasi_Mode;   //Setting UART pin as Quasi mode for transmit
  33   1        
  34   1        SCON = 0x50;      //UART0 Mode1,REN=1,TI=1
  35   1        TMOD |= 0x20;     //Timer1 Mode1
  36   1        
  37   1        set_SMOD;         //UART0 Double Rate Enable
  38   1        set_T1M;
  39   1        clr_BRCK;         //Serial port 0 baud rate clock source = Timer1
  40   1      
  41   1        TH1 = 0xe6; //38400
  42   1        set_TR1;
  43   1      }
  44          
  45          void Uart0_ISR() interrupt 4
  46          {
  47   1          if(TI)
  48   1        {
  49   2          TI = 0;
  50   2          global.uart.sendIsrFlag = true; //å‘é€æ•°æ®å‰ä¼šè¢«èµ‹å€¼ä¸º false
  51   2        }
  52   1      
  53   1          if(RI)//ä¸²å£0æ¥æ”¶ä¸­æ–­æ ‡å¿—ï¼ˆæœ‰æ•°æ®æ—¶ï¼Œç¡¬ä»¶ç½®1ï¼‰
C51 COMPILER V9.60.0.0   MAIN                                                              11/07/2019 15:42:57 PAGE 2   

  54   1          {
  55   2          RI = 0;//è½¯ä»¶ç½®0
  56   2          //SBUF = SBUF;
  57   2          uart0_isr(SBUF);
  58   2          }
  59   1      }
  60          
  61          void wtd_init(void)
  62          {
  63   1          TA=0xAA;
  64   1          TA=0x55;
  65   1      
  66   1          WDCON = 0x7; //æ ¹æ®æ‰‹å†Œ [2:0]ä½è¡¨ç¤ºä¸­æ–­åœ¨å¤šå°‘ç§’åæ‰§è¡Œï¼Œ0x7è¡¨ç¤º1.638såä¸­æ–­æ‰§è¡Œ
             -ã€‚æ ¹æ®éœ€è¦ä¿®æ”¹ä½3ä½
  67   1          set_WDTR;
  68   1          set_WDCLR;
  69   1          set_EWDT; 
  70   1        set_EA;//æ€»ä¸­æ–­è®°å¾—å¼€å¯ï¼Œset_EA;   
  71   1      }
  72          
  73          #define feedDog() set_WDCLR;  //å–‚ç‹—
  74          static unsigned int feedDogTimeCount = 0; //å–‚ç‹—æ ‡å¿—
  75          
  76          void feedDogInMain(void)
  77          {
  78   1        feedDogTimeCount = 0;
  79   1      }
  80          
  81          void feedDogInIsr(unsigned int ms)
  82          {
  83   1        //å†ä¸»å¾ªç¯ä¸­æ¸…é™¤å–‚ç‹—æ ‡å¿—ï¼Œåœ¨ä¸­æ–­ä¸­å–‚ç‹—ï¼Œå¦‚æœä¸»å¾ªç¯ä¸­ä¸¤ç§’æ²¡æœ‰æ¸…é™¤æ ‡å¿—åˆ™è
             -®¤ä¸ºä¸»å¾ªç¯æ­»äº†ï¼Œé‚£å°±åœæ­¢å–‚ç‹—
  84   1        //å¦‚æœä¸­æ–­æ­»äº†,ä¹Ÿä¼šåœæ­¢å–‚ç‹—
  85   1        if(++feedDogTimeCount < ms)
  86   1        {
  87   2          feedDogTimeCount = 0;
  88   2          feedDog();
  89   2        }
  90   1      }
  91          
  92          void main(void)
  93          {
  94   1        usartInit();
  95   1        init();
  96   1        initTimer3();
  97   1        wtd_init();
  98   1        feedDogInMain();  //å–‚ç‹—
  99   1      
 100   1        while(1)
 101   1        {
 102   2          feedDogInMain();  //å–‚ç‹—
 103   2          runMain();
 104   2        }
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    331    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              11/07/2019 15:42:57 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
